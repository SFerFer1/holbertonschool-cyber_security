require 'msf/core'

class MetasploitModule < Msf::Auxiliary
  include Msf::Auxiliary::Scanner
  include Msf::Exploit::Remote::SMB::Client

  def initialize(info = {})
    super(
      update_info(
        info,
        'Name'        => 'MS17-010 Vulnerability Checker',
        'Description' => 'Checks if a target is vulnerable to MS17-010 (EternalBlue)',
        'Author'      => ['Santiago'],
        'License'     => MSF_LICENSE
      )
    )

    register_options(
      [
        Opt::RHOSTS
      ]
    )
  end

  def run_host(ip)
    begin
      connect
      smb_login

      print_good("#{ip} appears to be VULNERABLE to MS17-010")
    rescue Rex::Proto::SMB::Exceptions::Error
      print_status("#{ip} does NOT appear to be vulnerable to MS17-010")
    ensure
      disconnect
    end
  end
end
